/*
 * Clock.h
 *
 *  Created on: 29.01.2015
 *      Author: sr
 */

#ifndef CLOCK_H_
#define CLOCK_H_

#include <Arduino.h>
#include <Wire.h>
#include "RTClib.h"

class LEDMatrixPanel;

class Clock {
public:
	Clock(LEDMatrixPanel& panel, RTC_DS1307& rtc);
	void update(long now);
	virtual ~Clock();
	void on();
	void writeTime(long now, byte* buffer = NULL);
	void off();
	void clear();
	boolean isClockOn() {
		return active;
	}

protected:

	void writeDigit(int digit, int xoffset, byte* buffer = NULL);

	RTC_DS1307* rtc;
	LEDMatrixPanel& panel;
	long nextClockRefresh;
	long nextRtcSync;
	uint8_t brightness;
	DateTime n;
	boolean active;

	byte mask[12][64] = {
	// big 0
			{ 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
					0xAA, 0xA0, 0x00, 0x00, 0x2A, 0x80, 0x00, 0x00, 0x0A, 0x00,
					0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x01, 0x40, 0x00, 0x00, 0x05, 0x50, 0x00, 0x00,
					0x15, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
					0x55, 0x55, 0x55, },
			// big 1
			{ 0xFE, 0xAA, 0xAF, 0xFF, 0xFE, 0xAA, 0xAF, 0xFF, 0xFE, 0xAA, 0xAF,
					0xFF, 0xFE, 0x80, 0x0F, 0xFF, 0xFE, 0x00, 0x0F, 0xFF, 0xFC,
					0x00, 0x0F, 0xFF, 0xF4, 0x00, 0x0F, 0xFF, 0x80, 0x00, 0x0A,
					0xAB, 0x00, 0x00, 0x0A, 0xAB, 0x00, 0x00, 0x0A, 0xAB, 0x00,
					0x00, 0x0A, 0xAB, 0xA8, 0x00, 0x0A, 0xAB, 0xA8, 0x00, 0x0A,
					0xAB, 0xFD, 0x55, 0x5F, 0xFF, 0xFD, 0x55, 0x5F, 0xFF, 0xFD,
					0x55, 0x5F, 0xFF, },
			// big 2
			{ 0xFE, 0xAA, 0xAB, 0xFF, 0xFA, 0xAA, 0xAF, 0xFF, 0xEA, 0xAA, 0xBF,
					0xFF, 0xA0, 0x00, 0x55, 0xFF, 0x80, 0x01, 0x55, 0x5F, 0x00,
					0x01, 0x40, 0x02, 0x00, 0x01, 0x40, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x0A, 0xA0, 0x00, 0x00, 0x2A, 0xA0, 0x00, 0x00,
					0xAA, 0xA0, 0x00, 0xAA, 0xAA, 0x80, 0x02, 0xAA, 0xAA, 0x00,
					0x02, 0xFF, 0xF5, 0x55, 0x5F, 0xFF, 0xD5, 0x55, 0x7F, 0xFF,
					0x55, 0x55, 0xFF, },
			// big 3
			{ 0xFF, 0xAA, 0xAA, 0xAF, 0xFF, 0xAA, 0xAA, 0xAB, 0xFF, 0xAA, 0xAA,
					0xAB, 0xF5, 0x55, 0x40, 0x2A, 0xD5, 0x55, 0x50, 0x2A, 0x00,
					0x15, 0x50, 0x0A, 0x00, 0x15, 0x50, 0x0A, 0x00, 0x15, 0x40,
					0x03, 0x00, 0x00, 0x00, 0x01, 0x00, 0xAA, 0xA0, 0x05, 0x02,
					0xAA, 0xA0, 0x15, 0xEA, 0xAA, 0xA0, 0x55, 0xFE, 0xAA, 0x81,
					0x57, 0xFF, 0x55, 0x55, 0x57, 0xFF, 0x55, 0x55, 0x57, 0xFF,
					0x55, 0x55, 0x5F, },
			// big 4
			{ 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
					0xAA, 0xAA, 0xAA, 0xA8, 0x02, 0xFF, 0xFF, 0xE0, 0x03, 0xFF,
					0xFF, 0xC0, 0x03, 0xFF, 0xFF, 0x40, 0x03, 0xFF, 0xFD, 0x40,
					0x03, 0xFF, 0xF5, 0x40, 0x03, 0xFF, 0xD5, 0x40, 0x03, 0xFF,
					0x55, 0x40, 0x03, 0xFD, 0x55, 0x40, 0x03, 0xF5, 0x55, 0x40,
					0x03, 0xD5, 0x55, 0x55, 0x57, 0x55, 0x55, 0x55, 0x57, 0x55,
					0x55, 0x55, 0x55, },
			// big 5
			{ 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xFF, 0xEA, 0xAA, 0xFF, 0xFF, 0xFA,
					0xAA, 0x55, 0x55, 0x50, 0x00, 0x55, 0x55, 0x50, 0x00, 0x01,
					0x55, 0x50, 0x00, 0x00, 0x55, 0x50, 0x00, 0x00, 0x15, 0x40,
					0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x2A, 0xAA, 0xAF, 0x00,
					0x2A, 0xAA, 0xBF, 0x40, 0x00, 0x00, 0xFF, 0x50, 0x00, 0x01,
					0x7F, 0x55, 0x55, 0x55, 0x7F, 0x55, 0x55, 0x55, 0x5F, 0x55,
					0x55, 0x55, 0x57, },
			// big 6
			{ 0xAA, 0xAA, 0xAA, 0xAB, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
					0xAA, 0xA8, 0x00, 0x00, 0xAA, 0xA0, 0x00, 0x00, 0x2A, 0x80,
					0x00, 0x00, 0x0A, 0x80, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
					0x02, 0x00, 0x00, 0x00, 0x03, 0x00, 0x2A, 0xA0, 0x07, 0x40,
					0x2A, 0xA0, 0x17, 0x50, 0x2A, 0xAA, 0xFF, 0x55, 0x2A, 0xAF,
					0xFF, 0x55, 0x55, 0x55, 0xFF, 0x55, 0x55, 0x55, 0x5F, 0x55,
					0x55, 0x55, 0x57, },
			// big 7
			{ 0xFA, 0xAA, 0xBF, 0xFF, 0xFA, 0xAA, 0xBF, 0xFF, 0xFA, 0xAA, 0xBF,
					0xFF, 0x50, 0x00, 0x15, 0x55, 0x50, 0x00, 0x15, 0x55, 0x50,
					0x00, 0x15, 0x55, 0x50, 0x00, 0x15, 0x55, 0x50, 0x00, 0x15,
					0x55, 0x50, 0x2A, 0x95, 0x55, 0x50, 0xAA, 0x95, 0x55, 0x50,
					0xAA, 0x15, 0x55, 0xFA, 0xA8, 0x15, 0x5F, 0xFA, 0xA0, 0x15,
					0x7F, 0xFF, 0xD5, 0x55, 0xFF, 0xFF, 0x55, 0x57, 0xFF, 0xFD,
					0x55, 0x5F, 0xFF, },
			// big 8
			{ 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
					0xAA, 0xA0, 0x00, 0x00, 0x0A, 0x80, 0x00, 0x00, 0x0A, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x05, 0x40, 0x00, 0x00,
					0x05, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
					0x55, 0x55, 0x55, },
			// big 9
			{ 0xEA, 0xAA, 0xAA, 0xAA, 0xFE, 0xAA, 0xAA, 0xAA, 0xFF, 0xFF, 0xFA,
					0xAA, 0xFD, 0x55, 0x50, 0xAA, 0x80, 0x55, 0x50, 0x2A, 0x00,
					0x15, 0x50, 0x0A, 0x00, 0x15, 0x40, 0x02, 0x00, 0x00, 0x00,
					0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
					0x00, 0x00, 0x05, 0x40, 0x00, 0x00, 0x15, 0x50, 0x00, 0x00,
					0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
					0x55, 0x55, 0x55, },
			// big :
			{ 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xEA, 0xAF, 0xFF, 0xFF, 0xEA, 0xAF,
					0xFF, 0xFF, 0xEA, 0xAF, 0xFF, 0xFF, 0xEA, 0xAF, 0xFF, 0xFF,
					0xEA, 0xAF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xD5, 0x5F, 0xFF, 0xFF, 0xD5, 0x5F, 0xFF, 0xFF, 0xD5, 0x5F,
					0xFF, 0xFF, 0xD5, 0x5F, 0xFF, 0xFF, 0xD5, 0x5F, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, },

			{ 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF }

	};

	byte digits[12][64] = {
	// big 0
			{ 0xAA, 0xFF, 0xFE, 0xAB, 0xAA, 0xFF, 0xFE, 0xAB, 0xAA, 0xFF, 0xFE,
					0xAB, 0xAA, 0xFF, 0xFE, 0xAB, 0xA0, 0x55, 0x54, 0x2B, 0xA0,
					0x55, 0x54, 0x2B, 0x00, 0x55, 0x54, 0x03, 0x00, 0x55, 0x54,
					0x03, 0x00, 0xAA, 0xA8, 0x03, 0x00, 0xAA, 0xA8, 0x03, 0x50,
					0xAA, 0xA8, 0x17, 0x50, 0xAA, 0xA8, 0x17, 0x55, 0xFF, 0xFD,
					0x57, 0x55, 0xFF, 0xFD, 0x57, 0x55, 0xFF, 0xFD, 0x57, 0x55,
					0xFF, 0xFD, 0x57, },
			// big 1
			{ 0xFF, 0xAA, 0xBF, 0xFF, 0xFF, 0xAA, 0xBF, 0xFF, 0xFF, 0xAA, 0xBF,
					0xFF, 0xFF, 0xAA, 0xBF, 0xFF, 0xFF, 0x80, 0x3F, 0xFF, 0xFF,
					0x00, 0x3F, 0xFF, 0xFD, 0x00, 0x3F, 0xFF, 0xF5, 0x00, 0x3F,
					0xFF, 0x80, 0x00, 0x2A, 0xAF, 0x00, 0x00, 0x2A, 0xAF, 0xAA,
					0x00, 0x2A, 0xAF, 0xAA, 0x00, 0x2A, 0xAF, 0xFF, 0x55, 0x7F,
					0xFF, 0xFF, 0x55, 0x7F, 0xFF, 0xFF, 0x55, 0x7F, 0xFF, 0xFF,
					0x55, 0x7F, 0xFF, },
			// big 2
			{ 0xFF, 0xAA, 0xAF, 0xFF, 0xFE, 0xAA, 0xBF, 0xFF, 0xFA, 0xAA, 0xFF,
					0xFF, 0xEA, 0xAB, 0xFF, 0xFF, 0xE8, 0x05, 0x55, 0xFF, 0xC0,
					0x05, 0x55, 0x5F, 0x40, 0x05, 0x50, 0x03, 0x40, 0x2F, 0xF0,
					0x03, 0x40, 0xAA, 0xA8, 0x03, 0x40, 0xAA, 0xA8, 0x03, 0xEA,
					0xAA, 0xA8, 0x03, 0xEA, 0xAA, 0xA0, 0x0B, 0xFF, 0xFF, 0xD5,
					0x5F, 0xFF, 0xFF, 0x55, 0x7F, 0xFF, 0xF5, 0x55, 0xFF, 0xFF,
					0xD5, 0x57, 0xFF, },
			// big 3
			{ 0xFF, 0xEA, 0xAA, 0xBF, 0xFF, 0xEA, 0xAA, 0xAF, 0xFF, 0xFF, 0xEA,
					0xAF, 0xFF, 0xFF, 0xFA, 0xAB, 0xFD, 0x55, 0x54, 0xAB, 0xD5,
					0x55, 0x54, 0x2B, 0x00, 0x55, 0x54, 0x0B, 0x00, 0x55, 0x50,
					0x0F, 0x00, 0xBF, 0xE0, 0x07, 0x02, 0xAA, 0xA8, 0x17, 0xEA,
					0xAA, 0xA8, 0x57, 0xFE, 0xAA, 0xA9, 0x57, 0xFF, 0xFF, 0xF5,
					0x5F, 0xFF, 0xFF, 0xD5, 0x5F, 0xFF, 0xD5, 0x55, 0x5F, 0xFF,
					0xD5, 0x55, 0x7F, },
			// big 4
			{ 0xAA, 0xAA, 0xAA, 0xAB, 0xAA, 0xAA, 0xAA, 0xAB, 0xAA, 0xAA, 0xAA,
					0xAB, 0xFF, 0xFF, 0xFA, 0xAF, 0xFF, 0xFF, 0xF8, 0x0F, 0xFF,
					0xFF, 0xF0, 0x0F, 0xFF, 0xFF, 0xD0, 0x0F, 0xFF, 0xFF, 0x50,
					0x0F, 0xFF, 0xFD, 0x50, 0x0F, 0xFF, 0xF5, 0x50, 0x0F, 0xFF,
					0xD5, 0x50, 0x0F, 0xFF, 0x55, 0xF0, 0x0F, 0xFD, 0x57, 0xF5,
					0x5F, 0xF5, 0x5F, 0xF5, 0x5F, 0xD5, 0x7F, 0xF5, 0x5F, 0x55,
					0xFF, 0xF5, 0x5F, },
			// big 5
			{ 0xAA, 0xFF, 0xEA, 0xAF, 0xFF, 0xFF, 0xFA, 0xAB, 0xFF, 0xFF, 0xFE,
					0xAB, 0xFF, 0xFF, 0xFE, 0xAB, 0x55, 0x55, 0x54, 0x03, 0x55,
					0x55, 0x54, 0x03, 0x01, 0x55, 0x54, 0x03, 0x00, 0x55, 0x50,
					0x07, 0x00, 0xBF, 0xEA, 0xAF, 0x00, 0xAA, 0xAA, 0xBF, 0x40,
					0xAA, 0xAA, 0xFF, 0x50, 0xAA, 0xAB, 0xFF, 0x55, 0x55, 0x57,
					0xFF, 0x55, 0x55, 0x55, 0xFF, 0x55, 0x55, 0x55, 0x7F, 0x55,
					0x55, 0x55, 0x5F, },
			// big 6
			{ 0xAA, 0xAA, 0xAA, 0xAF, 0xAA, 0xAA, 0xAA, 0xAB, 0xAA, 0xBF, 0xFA,
					0xAB, 0xAA, 0xFF, 0xFE, 0xAB, 0xAA, 0x55, 0x56, 0xAB, 0xA0,
					0x55, 0x54, 0x2B, 0xA0, 0x55, 0x54, 0x0B, 0xC0, 0x15, 0x50,
					0x0B, 0xC0, 0x2A, 0xA0, 0x0F, 0x40, 0xAA, 0xA8, 0x1F, 0x50,
					0xAA, 0xAA, 0xFF, 0x55, 0xAA, 0xAF, 0xFF, 0x55, 0xFF, 0xFF,
					0xFF, 0x55, 0xFF, 0xFF, 0xFF, 0x55, 0xD5, 0x55, 0xFF, 0x55,
					0x55, 0x55, 0x5F, },
			// big 7
			{ 0xFE, 0xAA, 0xFF, 0xFF, 0xFE, 0xAA, 0xFF, 0xFF, 0xFE, 0xAA, 0xFF,
					0xFF, 0xFE, 0xAA, 0xFF, 0xFF, 0x54, 0x00, 0x55, 0x57, 0x54,
					0x00, 0x55, 0x57, 0x54, 0x00, 0x55, 0x57, 0x54, 0xAA, 0xF5,
					0x57, 0x54, 0xAA, 0xF5, 0x57, 0x56, 0xAA, 0xF5, 0x57, 0xFE,
					0xAA, 0xD5, 0x5F, 0xFE, 0xAA, 0x55, 0x7F, 0xFF, 0xFD, 0x55,
					0xFF, 0xFF, 0xF5, 0x57, 0xFF, 0xFF, 0xD5, 0x5F, 0xFF, 0xFF,
					0x55, 0x7F, 0xFF, },
			// big 8
			{ 0xEA, 0xAA, 0xAA, 0xAF, 0xAA, 0xAA, 0xAA, 0xAB, 0xAA, 0xFF, 0xFE,
					0xAB, 0xAA, 0xFF, 0xFE, 0xAB, 0xA0, 0x55, 0x54, 0x2B, 0xA0,
					0x55, 0x54, 0x2B, 0x00, 0x55, 0x54, 0x03, 0x00, 0x55, 0x54,
					0x03, 0x00, 0xAA, 0xA8, 0x03, 0x00, 0xAA, 0xA8, 0x03, 0x50,
					0xAA, 0xA8, 0x17, 0x50, 0xAA, 0xA8, 0x17, 0x55, 0xFF, 0xFD,
					0x57, 0x55, 0xFF, 0xFD, 0x57, 0x55, 0x55, 0x55, 0x57, 0xD5,
					0x55, 0x55, 0x5F, },
			// big 9
			{ 0xFE, 0xAA, 0xAA, 0xAB, 0xFF, 0xFF, 0xFE, 0xAB, 0xFF, 0xFF, 0xFE,
					0xAB, 0xFF, 0xFF, 0xFE, 0xAB, 0xFD, 0x55, 0x54, 0xAB, 0x80,
					0x55, 0x54, 0x2B, 0x00, 0x55, 0x54, 0x0B, 0x00, 0x15, 0x50,
					0x0B, 0x00, 0x2A, 0xA0, 0x03, 0x00, 0xAA, 0xA8, 0x07, 0x40,
					0xAA, 0xA8, 0x17, 0x50, 0xAA, 0xA8, 0x57, 0x55, 0xFF, 0xFD,
					0x57, 0x55, 0x7F, 0xF5, 0x57, 0xD5, 0x55, 0x55, 0x57, 0xD5,
					0x55, 0x55, 0x57, },
			// big :
			{ 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFA, 0xBF,
					0xFF, 0xFF, 0xFA, 0xBF, 0xFF, 0xFF, 0xFA, 0xBF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xF5, 0x7F, 0xFF, 0xFF, 0xF5, 0x7F,
					0xFF, 0xFF, 0xF5, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, },

			{ 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
					0xFF, 0xFF, 0xFF }

	};

};

#endif /* CLOCK_H_ */
